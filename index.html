<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Electroscope Simulator</title>
  <style>
    :root{
      --bg:#f8fafc; --card:#fff; --text:#0f172a; --muted:#475569;
      --border:#e2e8f0; --blue:#2563eb; --red:#dc2626; --gold:#fbbf24;
      --shadow:0 10px 25px rgba(15,23,42,.08); --radius:16px;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .hero{text-align:center;margin:8px 0 14px}
    .hero h1{margin:0 0 6px;font-size:28px}
    .hero p{margin:0;color:var(--muted);line-height:1.5}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:18px;align-items:start}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .sim{
      position:relative;height:520px;display:flex;align-items:flex-end;justify-content:center;
      padding:12px 8px 14px;
      background: radial-gradient(rgba(15,23,42,.06) 1px, transparent 1px) 0 0 / 22px 22px, var(--card);
    }
    .panel{padding:16px}
    .panel h2{margin:0 0 10px;font-size:16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:10px 0}
    .pill{
      font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
      font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);
      background:#f1f5f9;color:var(--muted);white-space:nowrap;
    }
    .pill.ok{background:#dcfce7;border-color:#86efac;color:#166534;font-weight:800}
    input[type="range"]{width:100%}
    .seg{display:flex;gap:8px;background:#f1f5f9;border:1px solid var(--border);padding:6px;border-radius:12px}
    .seg button{
      flex:1;border:0;background:transparent;padding:10px;border-radius:10px;cursor:pointer;
      font-weight:800;color:var(--muted);
    }
    .seg button.active{background:var(--card);box-shadow:0 6px 14px rgba(15,23,42,.08)}
    .seg button.neg.active{color:var(--blue)}
    .seg button.pos.active{color:var(--red)}
    .btn{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid #0f172a;background:#0f172a;
      color:#fff;font-weight:900;cursor:pointer;
    }
    .btn:hover{filter:brightness(1.05)}
    .status{margin-top:12px;background:#eff6ff;border:1px solid #dbeafe;color:#1e3a8a;border-radius:var(--radius);padding:14px 16px}
    .status ul{margin:8px 0 0;padding:0 0 0 18px}
    .status li{margin:6px 0}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:rgba(2,6,23,.55);backdrop-filter:blur(6px);padding:18px;z-index:9999}
    .modal.open{display:flex}
    .modal-card{
      max-width:640px;width:100%;background:var(--card);border:1px solid var(--border);
      border-radius:20px;box-shadow:0 25px 60px rgba(0,0,0,.2);padding:18px;
    }
    .modal-card h3{margin:0 0 10px;font-size:20px}
    .modal-card p{margin:6px 0;color:var(--muted)}
    .modal-card .btn2{margin-top:12px;width:100%;padding:12px 14px;border-radius:12px;border:0;background:var(--blue);color:#fff;font-weight:900;cursor:pointer}
    .modal-card .btn2:hover{filter:brightness(1.05)}
    noscript{
      display:block;margin:10px auto;max-width:900px;background:#fff7ed;border:1px solid #fed7aa;
      padding:12px 14px;border-radius:12px;color:#7c2d12;
    }
  </style>
</head>

<body>
  <noscript>
    JavaScript is disabled, so the simulation cannot run. Please enable JavaScript and reload the page.
  </noscript>

  <div class="modal open" id="helpModal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <h3>⚡ How to Use</h3>
      <p><b>1)</b> Choose the wand charge type (Negative / Positive).</p>
      <p><b>2)</b> Drag the distance slider to <b>0</b> to touch the metal sphere.</p>
      <p><b>3)</b> When touching, charge transfers → the two gold leaves repel and spread apart.</p>
      <p><b>4)</b> Press <b>Ground (Reset)</b> to neutralize the electroscope.</p>
      <button class="btn2" id="startBtn" type="button">Start</button>
    </div>
  </div>

  <div class="wrap">
    <div class="hero">
      <h1>Electroscope Simulator</h1>
      <p>
        An electroscope detects electric charge. Touch the sphere to transfer charge and observe leaf repulsion.
      </p>
    </div>

    <div class="grid">
      <!-- SIM -->
      <div class="card sim">
        <svg viewBox="0 0 400 500" width="100%" height="100%" style="max-width:420px" aria-label="Electroscope SVG">
          <defs>
            <radialGradient id="sphereGradient" cx="30%" cy="30%">
              <stop offset="0%" stop-color="#f1f5f9"></stop>
              <stop offset="100%" stop-color="#64748b"></stop>
            </radialGradient>
          </defs>

          <!-- Glass jar -->
          <path d="M 120 180 L 120 450 Q 120 480 200 480 Q 280 480 280 450 L 280 180 Z"
                fill="rgba(220, 240, 255, 0.3)" stroke="#94a3b8" stroke-width="2"></path>
          <ellipse cx="200" cy="180" rx="80" ry="20"
                   fill="rgba(200, 230, 255, 0.4)" stroke="#94a3b8" stroke-width="2"></ellipse>

          <!-- Rubber stopper -->
          <rect x="180" y="160" width="40" height="40" fill="#475569" rx="2"></rect>

          <!-- Metal rod -->
          <rect x="195" y="100" width="10" height="200" fill="#cbd5e1" stroke="#64748b"></rect>

          <!-- Leaves group -->
          <g id="leaves" transform="translate(200, 300)">
            <g id="leafLeft">
              <rect x="-2" y="0" width="4" height="100" fill="#fbbf24" stroke="#d97706" rx="2"></rect>
              <text id="signLeft" x="-15" y="60" font-size="20" font-weight="900" opacity="0">+</text>
            </g>
            <g id="leafRight">
              <rect x="-2" y="0" width="4" height="100" fill="#fbbf24" stroke="#d97706" rx="2"></rect>
              <text id="signRight" x="5" y="60" font-size="20" font-weight="900" opacity="0">+</text>
            </g>
          </g>

          <!-- Metal sphere -->
          <circle cx="200" cy="80" r="30" fill="url(#sphereGradient)" stroke="#94a3b8"></circle>
          <text id="sphereSign" x="188" y="90" font-size="24" font-weight="900" opacity="0">+</text>

          <!-- Wand -->
          <g id="wand" transform="translate(450, 60)">
            <rect id="wandBody" x="0" y="0" width="200" height="40" rx="20"
                  fill="#dbeafe" stroke="#93c5fd" stroke-width="2"></rect>
            <path id="wandCap" d="M 0 0 L 40 0 L 40 40 L 0 40 A 20 20 0 0 1 0 0" fill="#3b82f6"></path>
            <text id="wandSign1" x="8" y="26" font-size="20" fill="#fff" font-weight="900">−</text>
            <text id="wandSign2" x="22" y="26" font-size="20" fill="#fff" font-weight="900">−</text>
            <circle id="touchGlow" cx="0" cy="20" r="15" fill="yellow" opacity="0"></circle>
          </g>
        </svg>
      </div>

      <!-- CONTROLS -->
      <div class="card panel">
        <div class="row">
          <h2>Controls</h2>
          <button id="helpBtn" class="pill" type="button">? Help</button>
        </div>

        <div class="row" style="margin-top:0;">
          <div style="width:100%;">
            <div class="row" style="margin:0 0 6px;">
              <div style="font-weight:900; color:var(--muted); font-size:13px;">Distance</div>
              <div class="pill" id="distancePill">DISTANCE: 100</div>
            </div>
            <input id="distance" type="range" min="0" max="100" value="100" />
            <div style="margin-top:6px; color:#94a3b8; font-size:12px;">Drag to 0 to touch the sphere.</div>
          </div>
        </div>

        <div style="margin-top:14px;">
          <div style="font-weight:900; color:var(--muted); font-size:13px; margin-bottom:8px;">Wand charge</div>
          <div class="seg">
            <button id="negBtn" class="neg active" type="button">Negative (−)</button>
            <button id="posBtn" class="pos" type="button">Positive (+)</button>
          </div>
        </div>

        <div style="margin-top:14px;">
          <button id="resetBtn" class="btn" type="button">Ground (Reset)</button>
        </div>

        <div class="status">
          <b>Current state</b>
          <ul>
            <li><span id="chargeText">Charge: Neutral</span></li>
            <li><span id="leafText">Leaves: Closed</span></li>
          </ul>
        </div>

        <div style="margin-top:12px; color:#94a3b8; font-size:12px;">
          Tip: If you still see a blank page, open DevTools (F12) → Console to check for JavaScript errors.
          This version avoids external dependencies, so it should be very reliable on school networks.
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Stable + fast engine: no frameworks, no external CDN =====

    // State
    let wandPosition = 100;            // 0..100 (0 = touching)
    let wandPolarity = "negative";     // "negative" | "positive"
    let electroscopeCharge = 0;        // -80..+80

    // Constants
    const MAX_LEAF_ANGLE = 45;
    const TOUCH_THRESHOLD = 2;
    const CHARGE_MAGNITUDE = 80;
    const CHARGE_STEP = 5;

    // DOM
    const distance = document.getElementById("distance");
    const distancePill = document.getElementById("distancePill");
    const negBtn = document.getElementById("negBtn");
    const posBtn = document.getElementById("posBtn");
    const resetBtn = document.getElementById("resetBtn");

    const leafLeft = document.getElementById("leafLeft");
    const leafRight = document.getElementById("leafRight");

    const signLeft = document.getElementById("signLeft");
    const signRight = document.getElementById("signRight");
    const sphereSign = document.getElementById("sphereSign");

    const wand = document.getElementById("wand");
    const wandBody = document.getElementById("wandBody");
    const wandCap = document.getElementById("wandCap");
    const wandSign1 = document.getElementById("wandSign1");
    const wandSign2 = document.getElementById("wandSign2");
    const touchGlow = document.getElementById("touchGlow");

    const chargeText = document.getElementById("chargeText");
    const leafText = document.getElementById("leafText");

    const helpModal = document.getElementById("helpModal");
    const startBtn = document.getElementById("startBtn");
    const helpBtn = document.getElementById("helpBtn");

    // Utils
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const isTouchingNow = () => wandPosition <= TOUCH_THRESHOLD;

    function computeAngle() {
      const inductionEffect = ((100 - wandPosition) / 100) * 20;
      const permanentAngle = (Math.abs(electroscopeCharge) / 100) * MAX_LEAF_ANGLE;

      let angle = permanentAngle;
      if (electroscopeCharge === 0 && wandPosition < 60) angle = inductionEffect * 0.5;
      return clamp(angle, 0, MAX_LEAF_ANGLE);
    }

    function stepPhysics() {
      if (!isTouchingNow()) return;

      if (wandPolarity === "positive" && electroscopeCharge < CHARGE_MAGNITUDE) {
        electroscopeCharge = Math.min(electroscopeCharge + CHARGE_STEP, CHARGE_MAGNITUDE);
      }
      if (wandPolarity === "negative" && electroscopeCharge > -CHARGE_MAGNITUDE) {
        electroscopeCharge = Math.max(electroscopeCharge - CHARGE_STEP, -CHARGE_MAGNITUDE);
      }
    }

    function render() {
      const touching = isTouchingNow();
      const angle = computeAngle();

      // Leaves rotation
      leafLeft.setAttribute("transform", `rotate(${-angle})`);
      leafRight.setAttribute("transform", `rotate(${angle})`);

      // Wand position (same mapping you used: 230..450)
      const wandSvgX = 230 + (wandPosition * 2.2);
      wand.setAttribute("transform", `translate(${wandSvgX}, 60)`);

      // Wand styling & symbols
      const isPos = wandPolarity === "positive";
      wandBody.setAttribute("fill", isPos ? "#fee2e2" : "#dbeafe");
      wandBody.setAttribute("stroke", isPos ? "#fca5a5" : "#93c5fd");
      wandCap.setAttribute("fill", isPos ? "#ef4444" : "#3b82f6");
      wandSign1.textContent = isPos ? "+" : "−";
      wandSign2.textContent = isPos ? "+" : "−";

      // Touch glow
      touchGlow.setAttribute("opacity", touching ? "0.65" : "0");

      // Charge signs
      const show = Math.abs(electroscopeCharge) > 10;
      const sign = electroscopeCharge > 0 ? "+" : "−";
      const signColor = electroscopeCharge > 0
        ? getComputedStyle(document.documentElement).getPropertyValue("--red").trim()
        : getComputedStyle(document.documentElement).getPropertyValue("--blue").trim();

      signLeft.textContent = sign;
      signRight.textContent = sign;
      sphereSign.textContent = sign;

      signLeft.setAttribute("fill", signColor);
      signRight.setAttribute("fill", signColor);
      sphereSign.setAttribute("fill", signColor);

      signLeft.setAttribute("opacity", show ? "1" : "0");
      signRight.setAttribute("opacity", show ? "1" : "0");
      sphereSign.setAttribute("opacity", Math.abs(electroscopeCharge) > 5 ? "1" : "0");

      // UI text
      distancePill.textContent = touching ? "TOUCHING" : `DISTANCE: ${wandPosition}`;
      distancePill.classList.toggle("ok", touching);

      chargeText.textContent = `Charge: ${Math.abs(electroscopeCharge) < 5 ? "Neutral" : "Charged"}`;
      leafText.textContent = `Leaves: ${angle < 2 ? "Closed" : "Separated (Repelling)"}`;
    }

    // Events
    distance.addEventListener("input", (e) => {
      wandPosition = Number(e.target.value);
      render(); // instant feedback
    });

    negBtn.addEventListener("click", () => {
      wandPolarity = "negative";
      negBtn.classList.add("active");
      posBtn.classList.remove("active");
      render();
    });

    posBtn.addEventListener("click", () => {
      wandPolarity = "positive";
      posBtn.classList.add("active");
      negBtn.classList.remove("active");
      render();
    });

    resetBtn.addEventListener("click", () => {
      electroscopeCharge = 0;
      render();
    });

    startBtn.addEventListener("click", () => helpModal.classList.remove("open"));
    helpBtn.addEventListener("click", () => helpModal.classList.add("open"));

    // Main loop (light + stable)
    function tick(){
      stepPhysics();
      render();
      requestAnimationFrame(tick);
    }

    // Init
    render();
    requestAnimationFrame(tick);
  </script>
</body>
</html>
