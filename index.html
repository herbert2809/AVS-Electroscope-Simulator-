<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô Phỏng Điện Nghiệm (Electroscope Simulator)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Hiệu ứng animation cơ bản */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-in { animation: fadeIn 0.5s ease-out; }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script type="text/babel">
        // Lấy các hàm từ React global object thay vì import
        const { useState, useEffect } = React;

        // --- COMPONENT PHỤ: Label ---
        const Label = ({ x, y, text, align = 'left' }) => (
            <g className="animate-in fade-in duration-500 pointer-events-none">
                <circle cx={x} cy={y} r="3" fill="#3b82f6" />
                <line 
                    x1={x} y1={y} 
                    x2={align === 'left' ? x - 40 : x + 40} 
                    y2={y} 
                    stroke="#3b82f6" 
                    strokeWidth="1" 
                />
                <text 
                    x={align === 'left' ? x - 45 : x + 45} 
                    y={y + 4} 
                    textAnchor={align === 'left' ? 'end' : 'start'} 
                    fontSize="14" 
                    fill="#1e293b" 
                    fontWeight="600"
                    className="uppercase tracking-wide"
                >
                    {text}
                </text>
            </g>
        );

        // --- COMPONENT CHÍNH: ElectroscopeSim ---
        const ElectroscopeSim = () => {
            // State
            const [wandPosition, setWandPosition] = useState(100); 
            const [wandPolarity, setWandPolarity] = useState('negative');
            const [electroscopeCharge, setElectroscopeCharge] = useState(0); 
            const [isTouching, setIsTouching] = useState(false);
            const [showHelp, setShowHelp] = useState(true); 
            const [showLabels, setShowLabels] = useState(false); 
            
            // Constants
            const MAX_LEAF_ANGLE = 45; 
            const TOUCH_THRESHOLD = 2; 

            // Physics Logic
            useEffect(() => {
                let targetCharge = electroscopeCharge;
                const isNowTouching = wandPosition <= TOUCH_THRESHOLD;
                setIsTouching(isNowTouching);

                if (isNowTouching) {
                    const chargeMagnitude = 80; 
                    if (wandPolarity === 'positive' && electroscopeCharge < chargeMagnitude) {
                        targetCharge = Math.min(electroscopeCharge + 5, chargeMagnitude);
                    } else if (wandPolarity === 'negative' && electroscopeCharge > -chargeMagnitude) {
                        targetCharge = Math.max(electroscopeCharge - 5, -chargeMagnitude);
                    }
                }

                if (targetCharge !== electroscopeCharge) {
                    setElectroscopeCharge(targetCharge);
                }
            }, [wandPosition, wandPolarity, electroscopeCharge]);

            // Visual Calculations
            const inductionEffect = (100 - wandPosition) / 100 * 20; 
            const permanentAngle = (Math.abs(electroscopeCharge) / 100) * MAX_LEAF_ANGLE;
            
            let currentAngle = permanentAngle;
            if (electroscopeCharge === 0 && wandPosition < 60) {
                currentAngle = inductionEffect * 0.5; 
            }

            const handleReset = () => {
                setElectroscopeCharge(0);
            };

            const wandSvgX = 230 + (wandPosition * 2.2); 

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-slate-50 p-4 font-sans text-slate-800 relative">
                
                {/* --- INSTRUCTION MODAL --- */}
                {showHelp && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-8 border border-slate-200 animate-in">
                        <h2 className="text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <span className="bg-indigo-100 text-indigo-600 p-2 rounded-lg">⚡</span> 
                        Hướng dẫn sử dụng
                        </h2>
                        <div className="space-y-4 text-slate-600 mb-8">
                        <div className="flex gap-3">
                            <div className="font-bold text-slate-400">1</div>
                            <p>Chọn <strong>Loại Điện Tích</strong> (Dương hoặc Âm) bằng nút bấm.</p>
                        </div>
                        <div className="flex gap-3">
                            <div className="font-bold text-slate-400">2</div>
                            <p>Kéo <strong>Thanh trượt khoảng cách</strong> sang trái để đưa thanh nhiễm điện lại gần quả cầu.</p>
                        </div>
                        <div className="flex gap-3">
                            <div className="font-bold text-slate-400">3</div>
                            <p>Chạm vào quả cầu để truyền điện tích và xem hai lá kim loại <strong>đẩy nhau</strong>.</p>
                        </div>
                        <div className="flex gap-3">
                            <div className="font-bold text-slate-400">4</div>
                            <p>Nhấn nút <strong>Nối đất (Reset)</strong> để trung hòa điện tích.</p>
                        </div>
                        </div>
                        <button 
                        onClick={() => setShowHelp(false)}
                        className="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-colors shadow-lg shadow-indigo-200"
                        >
                        Bắt đầu
